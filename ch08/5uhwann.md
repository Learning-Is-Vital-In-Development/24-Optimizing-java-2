# GC 로깅, 모니터링, 튜닝, 툴
- GC 로깅 및 모니터링은 자바 성능 튜닝에서 가장 중요한 요소이다.

## GC 로깅 개요
- 모든 중요 어플리케이션에서 설정할 2가
  1. GC 로그 생성
  2. 어플리케이션 출력과 별도의 특정 파일에 GC 로그 보관 
- GC 로깅은 오버헤드가 거의 없는것이나 다름없기 때문에 주요 JVM 프로세스는 항상 GC 로깅을 활성화해야 한다.
  - **GC 로깅 플래그**: `-Xloggc:gc.log -XX:+PrintGCDetails -XX+PrintTenuringDistribution -XX:+PrintGcTimeStamps -XX:+PrintGCDateStamps`
- 필수 플래그 주의 사항
  - 기존 플래그 verbose:gc는 지우고 PrintGCDetails를 사용
  - PrintGCDateStamps, PrintGCTimeStamps는 각각 GC 이벤트와 어플리케이션 이벤트(로그파일),GC와 다른 내부 JVM 이벤트를 연관짓는 용도로 사용된다.

### GC 로그 데이터의 장점
- GC 로그에 쌓인 기초 데이터는 특정 GC 이벤트와 연관 지을 수 있어 모든 의미 있는 분석작업을 수행 가능하게 한다.
- +GC로깅이 어플리케이션 성능에 미치는 영향은 0에 가까우므로 운영계는 무조건 활성화해야 한다.

## GC 로그 파싱 툴(파싱하려 하지말고 툴 사용)
- 센섬
- GCViewer(오픈소스)

## GC 기본 튜닝
- 엔지니어는 튜닝 수행 시 다음 네가지 주요 인자를 면밀히 관찰/측정해야 한다.
  - **할당**
  - 중단 민감도
  - 처리율 추이
  - 객체 수명
- GC 튜닝 시 플래그는 다음과 같이 추가
  - 한번에 한 플래그씩 추가
  - 각 플래그가 무슨 작용을 하는지 숙지
  - 부수 효과를 일으키는 플래그 조합이 있다는 것을 명심
- 성능 저하의 원인이 GC인지 체크(이 요소들이 모두 보인다면 GC 성능 이슈 높음) 
  - CPU 사용률이 100%에 가까운가?
  - 대부분의 시간(90% 이상)이 유저 공간에서 소비되는가?
  - GC로그가 쌓이고 있다면 현재 GC가 실행중이라는 증거

### 할당
- 할당률 분석은 실제 가비지 수집기 튜닝 시 성능 개선 여부를 판단하는데 필요한 요소
- 할당률의 수치가 1GB/s 이상으로 일정 시간 지속된다면 가비지 수집 튜닝만으로는 해결할 수 없는 성능 문제 발생 가능성 높음
- 초기 집중 할당 전략
  - 굳이 없어도 그만인 사소한 객체
  - 박싱 비용
  - 도메인 객체
    - char[]
    - byte[]
    - double[]
    - 맵 엔트리
    - Object[]
    - 내부 자료 구조
  - 논JDK 프레임워크 객체

### 중단시간
- 중단 시간 튜닝 시 어플리케이션 응답 요건에 따라 허용 가능 중단 시간을 세 대역으로 분리하여 초기 수집기 선정(p. 238)
  1. ` >1초 `
  2. `1초 ~ 100밀리초`
  3. ` < 100 밀리초`

## G1 튜닝 기초 가이드
- 영 세대를 크게 설정
- 테뉴어드 한계치를 최대 15 정도로 늘려 잡는다.
- 어플리케이션에서 수용 가능한 최장 중단시간 목표를 정한다.
